---
title: "[컴퓨터구조&운영체제] 8. 입출력장치 "
excerpt: "입출력장치"

categories:
  - Concept
tags:
  - [concept, CS&OS]

permalink: /concept/cs-&-os-8/

toc: true
toc_sticky: true

date: 2023-12-10
last_modified_at: 2023-12-10
---
# 8. 입출력장치 

## 1. 장치 컨트롤러와 장치 드라이버 

- 종류가 매우 다양; 정보 교환 방식 규격화 어려움
- 보조기억장치도 입출력장치에 포함 

### 장치 컨트롤러 device controller 

= I/O controller, I/O module 

- 입출력장치는 각자의 장치 컨트롤러를 통해 컴퓨터 내부와 데이터를 교환
- 장치 컨트롤러는 하나 이상의 입출력장치와 연결돼 있음 

#### 전송률 transfer rate 

데이터를 교환하는 속도 지표 

- 일반적으로 입출력장치의 데이터 전송률은 낮고 CPU와 메모리 데이터 전송률은 높음
- 전송률이 비슷하지 않으면 통신에 어려움이 있어 입출력장치는 장치 컨트롤러라는 하드웨어를 통해 연결됨 

#### 역할 

1. CPU와 입출력장치간의 통신 중개
2. 오류 검출
3. 데이터 버퍼링 

`버퍼링`: 전송률이 높은 장치와 낮은 장치 사이에 주고받는 데이터를 `버퍼`라는 임시 저장 공간에 저장하여 전송률을 비슷하게 맞추는 방법 

#### 내부 구조 

- 데이터 레지스터
  - 교환할 데이터가 담기는 레지스터
  - 버퍼 역할
  - 교환할 데이터가 많은 경우 RAM을 대신 사용하기도 함 

- 상태 레지스터
  - 상태 정보 저장; 입출력 준비 여부, 작업 완료, 오류 

- 제어 레지스터
  - 입출력장치가 수행할 내용에 대한 제어 정보와 명령 

### 장치 드라이버 device driver 

장치 컨트롤러의 동작 감지, 제어를 통해 컨트롤러가 컴퓨터 내부와 정보 교환이 가능하도록 하는 프로그램 

- 실행 과정에서 메모리에 저장; 프로그램임
- 입출력장치를 연결하기 위한 소프트웨어적 통로
- 컴퓨터가 연결된 장치의 드라이버를 인식, 실행 가능하다면 컴퓨터 내부와 정보 교환 가능
- 장치 드라이버를 인식하고 실행하는 주체는 운영체제
- 장치 제작자가 별개로 제공하는 장치 드라이버는 입출력장치에서 직접 설치해야 사용 가능 

## 2. 다양한 입출력 방법 

CPU와 장치 컨트롤러가 정보를 주고받는 방법
1. 프로그램 입출력
2. 인터럽트 기반 입출력
3. DMA 입출력 

### 프로그램 입출력 

프로그램 속 명령어로 입출력장치를 제어하는 방법 

- CPU가 입출력 명령어를 만나면 입출력장치에 연결된 장치 컨트롤러와 사호작용해 입출력 작업 수행 

메모리에 저장된 정보를 하드 디스크에 백업하는 과정
1. CPU: 하드 디스크 컨트롤러의 제어 레지스터에 쓰기 명령 보냄
  - 메모리에 저장된 정보를 하드 디스크에 백업한다 = 하드 디스크에 새로운 정보를 쓴다
2. 하드 디스크 컨트롤러: 하드 디스크 상태를 확인해 준비된 경우 상태 레지스터에 준비되었다고 표시
3. CPU: 상태 레지스터를 주기적으로 읽어보며 하드 디스크 준비 여부 확인 후 준비가 되었따면 백업할 메모리의 정보를 데이터 레지스터에 씀
  - 백업(= 쓰기) 작업이 끝나지 않았다면 1~3 반복
  - 백업 작업이 끝났다면 종료 

- 입출력 작업은 CPU가 장치 컨트롤러의 레지스터 값을 읽고 씀으로써 이루어짐
- CPU가 입출력장치의 주소를 아는 방법: 메모리 맵 입출력, 고립형 입출력 

#### 메모리 맵 입출력 

메모리에 접근하기 위한 주소 공간과 입출력장치에 접근하기 위한 주소 공간을 하나의 주소 공간으로 간주하는 방법 

- 메모리와 입출력장치는 같은 주소 공간 사용
- 메모리 주소 공간이 축소됨(나눠 쓰니까)
- 메모리와 입출력장치에 같은 명령어 사용 가능 

#### 고립형 입출력 

메모리를 위한 주소 공간과 입출력장치를 위한 주소 공간을 분리하는 방법 

- 메모리와 입출력장치는 분리된 주소 공간 사용
- 메모리 주소 공간이 출소되지 않음
- 입출력 전용 명령어 사용 

### 인터럽트 기반 입출력 

인터럽트를 기반으로 하는 입출력 

#### 인터럽트 

- CPU가 입출력장치에 처리할 내용을 명령하면 입출력장치가 명령어를 수행하는 동안 CPU는 다른 일을 할 수 있음
- 입출력장치가 CPU에게 인터럽트 요청 신호를 보내면 CPU는 하던 일을 멈추고 인터럽트를 처리하는 인터럽트 서비스 루틴 프로그램 실행 후 다시 복귀 

#### 인터럽트 기반 입출력 과정 

- 입출력장치에 의한 하드웨어 인터럽트는 장치 컨트롤러에 의해 발생
- CPU가 장치 컨트롤러에 입출력 명령
- -> 장치 컨트롤러가 입출력장치 제어, 입출력 수행/CPU는 다른 일 가능
- -> 장치 컨트롤러가 입출력 작업을 끝내고 CPU에 인터럽트 요청 신호 
- -> CPU는 하던 일을 백업하고 인터럽트 서비스 루틴 실행 

#### 폴링 polling 

입출력장치의 상태, 처리할 데이터 등을 주기적으로 확인하는 방식 

- 인터럽트보다 CPU의 부담 큼 

#### 인터럽트가 동시에 발생하는 경우 

1. 발생 순서대로 처리
  - 인터럽트를 처리하는 도중 발생한 다른 인터럽트의 요청을 받아들이지 않고 기존의 인터럽트 서비스 루틴이 끝나면 발생했던 인터럽트 서비스 루틴 실행
  - 인터럽트 사이 우선순위를 고려하지 못함 

2. 우선순위 순으로 처리
  - 인터럽트를 처리하는 중이라도 우선순위가 높은 인터럽트가 발생한다면 기존 인터럽트의 실행을 멈추고 우선순위가 높은 인터럽트부터 처리
  - 플래그 레지스터 속 인터럽트 비트가 활성화되엉 있는 경우
  - 인터럽트 비트를 활성화해도 무시할 수 없는 인터럽트인 `Non Maskable Interrupt`가 발생한 경우 

#### PIC: Programmable Interrupt Controller 

하드웨어 인터럽트 요청들으 우선순위 판별 후 처리해야 할 인터럽트를 CPU에 알려주는 하드웨어 장치 

- 여러 개의 핀에 CPU에 하드웨어 인터럽트 요청을 보낼 수 있는 하드웨어가 연결돼 있음
- CPU에 여러 인터럽트 요청 중 먼저 처리해야 할 인터럽트 알려줌 

과정
1. PIC: 장치 컨트롤러에서 인터럽트 요청 신호 수용
2. PIC: 인터럽트 우선순위 판단 후 CPU에 인터럽트 요청 신호 전송
3. CPU: PIC에 인터럽트 확인 신호 전송
4. PIC: 데이터 버스를 통해 CPU에 인터럽트 벡터 전송
5. CPU: 인터럽트 벡터를 통해 요청 주체 알게 되고 해당 장치의 인터럽트 서비스 루틴 실행 

- `NMI`는 우선순위가 가장 높기 때문에 우선순위 판별을 하지 않음
- PIC가 우선순위를 조정해 주는 인터럽트는 인터럽트 비트를 통해 막을 수 있는 하드웨어 인터럽트 

### DMA 입출력 

= Direct Memory Access
직접 메모리에 접근할 수 있는 입출력 기능 

- 입출력장치와 메모리가 CPU를 거치지 않고 상호작용할 수 있는 입출력 방식
- DMA 입출력을 위해서는 시스템 버스에 연결된 DMA 컨트롤러 필요 

#### 과정 

1. CPU: DMA 컨트롤러에 입출력장치의 주소, 수행 연산, 읽거나 쓸 메모리 주소 등의 정보로 입출력 작업 명령
2. DMA 컨트롤러: CPU 대신 장치 컨트롤러와 상호작용해 입출력 작업 수행
  - 필요한 경우 메모리에 직접 접근해 정보를 읽거나 씀
3. DMA 컨트롤러: 입출력 작업이 끝나면 CPU에 인터럽트를 걸어 작업이 끝났음을 알림 

- CPU와 DMA 컨트롤러가 동시에 시스템 버스 사용 불가; CPU가 시스템 버스를 사용하지 않을 때 사용하거나 허락을 구하고 집중적으로 이용
- 사이클 스틸링: DMA의 시스템 버스 이용 

#### 입출력 버스 

- CPU, 메모리, DMA 컨트롤러, 장치 컨트롤러가 모두 같은 버스 공유시 DMA를 위해 한 번 메모리 접근시마다 시스템 버스 두 번 사용
- 그때마다 CPU는 시스템 버스를 이용하지 못함 

- 장치 컨트롤러들이 시스템 버스가 아닌 입출력 버스로 DMA 컨트롤러에 연결된다면 시스템 버스 사용 빈도 낮출 수 있음
- PCI 버스, PCI Expresss버스 등이 존재